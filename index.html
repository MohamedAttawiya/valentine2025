<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A cute Valentine's Day page to ask someone to be your Valentine!">
  <meta name="theme-color" content="#ffd0e5">
  <title>Manona's Valentine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    .gradient-background {
      background: linear-gradient(180deg, #ffd0e5 0%, #ffe8f2 36%, #ffffff 100%);
      min-height: 100vh;
    }

    .bounce {
      animation: bounce 2s ease infinite;
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
      }
      40% {
        transform: translateY(-20px);
      }
      60% {
        transform: translateY(-10px);
      }
    }
  </style>
  <!-- Preload images so transitions feel instant -->
  <link rel="preload" as="image" href="./images/image1.gif">
  <link rel="preload" as="image" href="./images/image2.gif">
  <link rel="preload" as="image" href="./images/image3.gif">
  <link rel="preload" as="image" href="./images/image4.gif">
  <link rel="preload" as="image" href="./images/image5.gif">
  <link rel="preload" as="image" href="./images/image6.gif">
  <link rel="preload" as="image" href="./images/image7.gif">
  <link rel="preload" as="image" href="./images/personalized/Screenshot%202026-02-08%20202555.png">
  <link rel="preload" as="image" href="./images/personalized/Screenshot%202026-02-08%20202633.png">
  <link rel="preload" as="image" href="./images/personalized/Screenshot%202026-02-08%20202701.png">
  <link rel="preload" as="image" href="./images/personalized/Screenshot%202026-02-08%20202724.png">
  <link rel="preload" as="image" href="./images/personalized/Screenshot%202026-02-08%20202759.png">
</head>
<body class="gradient-background">
  <main class="flex items-center justify-center h-screen">
    <section class="flex flex-col items-center p-4">
      <img
        id="imageDisplay"
        src="./images/image1.gif"
        alt="Cute kitten with flowers"
        class="rounded-md h-[300px] object-cover"
      />
      <h1 id="valentineQuestion" class="text-4xl font-bold italic text-[#bd1e59] my-4">
        Manona, will you be my Valentine?
      </h1>
      <button
        id="invitationButton"
        class="hidden inline-flex items-center justify-center whitespace-nowrap rounded-md text-lg font-medium cursor-pointer px-4 py-2 bg-[#bd1e59] text-white transition-colors hover:bg-[#9f174a] mb-3"
      >
        Get my invitation
      </button>
      <p id="emailStatus" class="hidden text-sm font-medium text-[#7a1740] mb-2"></p>
      <div id="responseButtons" class="flex gap-4 pt-5 items-center">
        <button
          id="yesButton"
          class="bounce inline-flex items-center justify-center whitespace-nowrap rounded-md text-xl font-medium cursor-pointer px-4 py-2 bg-green-500 text-white transition-all duration-300 ease-in-out hover:bg-green-400 min-h-12 min-w-[75px]"
        >
          Yes
        </button>
        <button
          id="noButton"
          class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-xl font-medium cursor-pointer px-4 py-2 bg-red-500 text-white transition-colors hover:bg-red-700 h-12 min-w-[75px]"
        >
          No
        </button>
      </div>
    </section>
  </main>

  <script>
    (() => {
      // DOM references
      const yesButton = document.getElementById('yesButton');
      const noButton = document.getElementById('noButton');
      const imageDisplay = document.getElementById('imageDisplay');
      const valentineQuestion = document.getElementById('valentineQuestion');
      const invitationButton = document.getElementById('invitationButton');
      const responseButtons = document.getElementById('responseButtons');
      const emailStatus = document.getElementById('emailStatus');

      // Configuration
      const GROWTH_PER_CLICK = 35;
      const FONT_GROWTH_PER_CLICK = 25;
      const MAX_NO_CLICKS = 4;
      const EMAILJS_SERVICE_ID = 'service_dt5ncfj';
      const EMAILJS_TEMPLATE_ID = 'template_jk2yewf';
      const EMAILJS_PUBLIC_KEY = 'Wz9j7wVxvvg37DtB8';
      const INVITATION_TO_EMAIL = 'mohameddyousseff1@gmail.com';
      const INVITATION_SUBJECT = 'Invitation';

      const IMAGE_PATHS = [
        './images/image1.gif',
        './images/image2.gif',
        './images/image3.gif',
        './images/image4.gif',
        './images/image5.gif',
        './images/image6.gif',
        './images/image7.gif',
      ];

      const YES_IMAGE_PATHS = [
        './images/personalized/Screenshot%202026-02-08%20202555.png',
        './images/personalized/Screenshot%202026-02-08%20202633.png',
        './images/personalized/Screenshot%202026-02-08%20202701.png',
        './images/personalized/Screenshot%202026-02-08%20202724.png',
        './images/personalized/Screenshot%202026-02-08%20202759.png',
      ];

      const NO_BUTTON_MESSAGES = [
        'No',
        'Ya kalba',
        'ybnty fakare',
        'ya manonaaa :(',
        'BENT DOSY YES',
      ];

      const ALT_TEXTS = [
        'Cute kitten with flowers',
        'Sad kitten looking up',
        'Kitten begging',
        'Heartbroken kitten',
        'Crying kitten',
        'Devastated kitten',
        'Happy kitten celebrating',
      ];

      // State
      let noClickCount = 0;
      let buttonHeight = 48;
      let buttonWidth = 80;
      let fontSize = 20;
      let invitationRequestDone = false;

      noButton.addEventListener('click', () => {
        if (noClickCount >= MAX_NO_CLICKS) return;

        noClickCount++;

        // Update image and alt text
        imageDisplay.src = IMAGE_PATHS[noClickCount];
        imageDisplay.alt = ALT_TEXTS[noClickCount];

        // Grow the "Yes" button to make it harder to ignore
        buttonHeight += GROWTH_PER_CLICK;
        buttonWidth += GROWTH_PER_CLICK;
        fontSize += FONT_GROWTH_PER_CLICK;

        yesButton.style.height = `${buttonHeight}px`;
        yesButton.style.width = `${buttonWidth}px`;
        yesButton.style.fontSize = `${fontSize}px`;

        // Update "No" button text with increasingly desperate messages
        noButton.textContent = NO_BUTTON_MESSAGES[noClickCount];
      });

      yesButton.addEventListener('click', () => {
        imageDisplay.src = YES_IMAGE_PATHS[0];
        imageDisplay.alt = 'A favorite photo of Manona';
        valentineQuestion.textContent = 'Love you to the moon and back';
        invitationButton.classList.remove('hidden');
        responseButtons.style.display = 'none';

        // Show all personalized pictures after "Yes"
        let yesImageIndex = 1;
        const yesImageInterval = setInterval(() => {
          if (yesImageIndex >= YES_IMAGE_PATHS.length) {
            clearInterval(yesImageInterval);
            return;
          }

          imageDisplay.src = YES_IMAGE_PATHS[yesImageIndex];
          yesImageIndex++;
        }, 1200);

        // Heart-shaped confetti for a valentine theme
        const heart = confetti.shapeFromPath({
          path: 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        });

        const defaults = { spread: 360, ticks: 100, gravity: 0, decay: 0.94, startVelocity: 20, shapes: [heart], colors: ['#ff69b4', '#ff1493', '#ff6b81', '#e84393'] };

        confetti({ ...defaults, particleCount: 50, scalar: 2 });
        confetti({ ...defaults, particleCount: 25, scalar: 3 });
        confetti({ ...defaults, particleCount: 10, scalar: 4 });
      });

      invitationButton.addEventListener('click', async () => {
        if (invitationRequestDone) return;

        invitationButton.disabled = true;
        invitationButton.textContent = 'Sending...';

        const invitationSent = await sendInvitationEmail();
        if (invitationSent) {
          invitationRequestDone = true;
          invitationButton.textContent = 'Invitation Sent';
          return;
        }

        invitationButton.disabled = false;
        invitationButton.textContent = 'Get my invitation';
      });

      async function sendInvitationEmail() {
        try {
          emailStatus.textContent = 'Sending invitation...';
          emailStatus.classList.remove('hidden');

          const invitationTextResponse = await fetch('./email-content.md', {
            method: 'GET',
            cache: 'no-store',
          });

          if (!invitationTextResponse.ok) {
            throw new Error('Could not load invitation text');
          }

          const invitationText = await invitationTextResponse.text();

          const response = await fetch('https://api.emailjs.com/api/v1.0/email/send', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              service_id: EMAILJS_SERVICE_ID,
              template_id: EMAILJS_TEMPLATE_ID,
              user_id: EMAILJS_PUBLIC_KEY,
              template_params: {
                to_email: INVITATION_TO_EMAIL,
                subject: INVITATION_SUBJECT,
                message: invitationText,
                invitation_text: invitationText,
              },
            }),
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText || 'Failed to send');
          }

          emailStatus.textContent = 'Open mennaemad10@yahoo.com';
          return true;
        } catch (error) {
          emailStatus.textContent = 'Could not send invitation right now.';
          return false;
        }
      }
    })();
  </script>
</body>
</html>
